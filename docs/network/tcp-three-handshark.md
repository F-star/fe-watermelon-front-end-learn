# 你需要知道的 TCP 三次握手

TCP，全称 Transmission Control Protocal。从名字可以知道这是一个用于 **控制传输** 的位于传输层的协议。

TCP 位于 TCP/IP 和 OSI 模型的传输层。我们最常使用的 HTTP 协议，底层通常使用的就是 TCP 协议。

如果要在客户端和服务端创建 TCP 连接，我们需要在开始的时候发送三个请求确认双方的通信能力正常，这三次连接就被称为 TCP 的三次握手。

TCP 的三次握手
---------

下图为 TCP 头部的结构，我们的 TCP 三次握手主要用到其中的标黄的部分。

![图片](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ef5745ec430042128b638171c1278567~tplv-k3u1fbpfcp-zoom-1.image)

  

下面开始讲解这三次握手。  

### 第一次握手

客户端给服务端发送一个 TCP 报文。在 TCP 头部中：

1.  将 SYN 标志位设置为 1；
    
2.  然后给 seq 赋予一个随机数（假设这个随机数是 x）
    

所谓标志位，其实就是一个比特的数据，设置为 1 ，其实就类似编程中将一个布尔值设置为 true。

SYN 代表同步（sync）的意思，seq 是序列号（Sequence number）的意思，是一个可以装载数值的地方，我们给它设置为随机数，是用来做凭证（token）的，稍后服务端会使用它。

### 第二次握手

服务端收到 SYN，知悉客户端希望建立 TCP 连接，并拿到了一个 seq 随机数。

服务端于是向客户端发送 TCP 报文，TCP 头中：

1.  将 ACK 标志位设置为 1，表示已知悉（acknowledge）客户端的连接请求；
    
2.  ack 的值设置为客户端传过来的 seq 值 + 1（即 x+1）；
    
3.  将 SYN 标志位设置为 1，表示服务端也要连接；
    
4.  seq 的值设置一个随机数（假设随机数为 y）
    

服务端通过 ACK 和 ack 来告知客户端已知悉连接请求，并发送自己的 SYN 和 seq 来请求和客户端的连接。

### 第三次握手

客户端收到 TCP 请求，首先验证 ACK 是否为 1， ack 是否为 x+1。

如果是，说明服务端的这个发送是对应第一次握手的返回。客户端会再发送一个 TCP 请求：

1.  ACK 设置为 1；
    
2.  ack 设置为服务端 ack 的值 + 1（即 y + 1）
    

  

三次握手后，TCP 连接就建立了。

总结
--

三次握手，简单来说，就是这样的：

1.  客户端 -> 服务端：SYN=1, seq=x （x为随机数）
    
2.  服务端 -> 客户端：ACK=1, ack=x+1, SYN=1, seq=y （y为随机数）
    
3.  客户端 -> 服务端：ACK=1, ack=y+1
    

![图片](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e24bd43fa7334477b9c66b65d4bdbff4~tplv-k3u1fbpfcp-zoom-1.image)

我是前端西瓜哥，欢迎关注我，掌握更多前端面试题。